# Essential storage permissions
gcloud projects add-iam-policy-binding gcp-cloud-agent-testing-2025 \
    --member="serviceAccount:gcp-agent-testing@gcp-cloud-agent-testing-2025.iam.gserviceaccount.com" \
    --role="roles/storage.admin"



# Enable Firestore API (if not already enabled)
gcloud services enable firestore.googleapis.com

# Grant Firestore Database Admin role
gcloud projects add-iam-policy-binding gcp-cloud-agent-testing-2025 \
    --member="serviceAccount:gcp-agent-testing@gcp-cloud-agent-testing-2025.iam.gserviceaccount.com" \
    --role="roles/datastore.owner"

# Alternative: Grant broader Cloud Datastore User role
gcloud projects add-iam-policy-binding gcp-cloud-agent-testing-2025 \
    --member="serviceAccount:gcp-agent-testing@gcp-cloud-agent-testing-2025.iam.gserviceaccount.com" \
    --role="roles/datastore.user"


# Check if Firestore is already set up
gcloud firestore databases list --project=gcp-cloud-agent-testing-2025


# Create Firestore database in Native mode
gcloud firestore databases create --location=nam5 --project=gcp-cloud-agent-testing-2025


# Verify it was created
gcloud firestore databases list --project=gcp-cloud-agent-testing-2025

# Test your app
python app.py